server {
    listen 80;  # 設定 Nginx 監聽 80 號 port（預設 HTTP 連線埠）

    server_name localhost;  # 主機名稱（你也可以改成你的網域或公網 IP）

    # ✅ 處理圖片與影片上傳後的讀取請求（像 /file/getFile?fileName=xxx）
    location /file/ {
        proxy_pass http://backend:21090/file/;  # 轉發到 Spring Boot 的 backend 容器（或 IP:port），注意結尾有 "/"
        proxy_set_header Host $host;  # 將原始 Host 傳給後端
        proxy_set_header X-Real-IP $remote_addr;  # 把使用者真實 IP 傳給後端
    }

    # ✅ 處理所有 API 請求（像 /api/book-manage-sys-api/v1.0/xxx）
    location /api/ {
        proxy_pass http://backend:21090/api/;  # 轉發給 Spring Boot 的後端 API
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # ✅ 處理 Vue 前端的所有靜態資源與 SPA 路由（ex: /admin, /login）
    location / {
        root /usr/share/nginx/html;  # 指定前端打包後的 index.html、js、css 等靜態檔案的位置
        index index.html;  # 預設首頁檔案為 index.html

        # 如果找不到對應的檔案，就導向 index.html（Vue 的 history 模式）
        try_files $uri $uri/ /index.html;
    }
}